<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Resources</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49B8',
                        'primary-light': '#7F7EE7',
                        learn: {
                            light: '#22c55e',
                            dark: '#166534'
                        },
                        try: {
                            light: '#f97316',
                            dark: '#9a3412'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-in-out',
                        'bounce-in': 'bounceIn 0.8s ease-in-out',
                        'slide-in-right': 'slideInRight 0.5s ease-in-out',
                        'pulse-light': 'pulseLight 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '70%': { transform: 'scale(1.05)', opacity: '1' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(50px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        pulseLight: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.7' },
                        }
                    },
                    boxShadow: {
                        'card': '0 10px 20px rgba(0, 0, 0, 0.05), 0 6px 6px rgba(0, 0, 0, 0.05)',
                        'card-hover': '0 15px 30px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.04)',
                    }
                }
            }
        };
    </script>
    <style type="text/css">
        .hidden {
            display: none !important;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-in-out;
        }
        
        .bounce-in {
            animation: bounceIn 0.8s ease-in-out;
        }
        
        .slide-in-right {
            animation: slideInRight 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        @keyframes slideUp {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes slideInRight {
            0% { transform: translateX(50px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulseLight {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .resource-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .resource-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.04);
        }

        /* Light/Dark mode transitions */
        .dark .dark\:bg-gray-900,
        .dark .dark\:bg-gray-800,
        .dark .dark\:text-white,
        .dark .dark\:text-gray-200,
        .dark .dark\:border-gray-700,
        html {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: #4b5563;
        }
        
        /* Category tab styling */
        .category-tab {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        
        .category-tab.active {
            border-bottom: 2px solid currentColor;
        }
        
        .category-tab:not(.active):hover {
            border-bottom: 2px solid rgba(93, 92, 222, 0.3);
        }
        
        /* Notification animation */
        .notification-enter {
            animation: notificationEnter 0.5s forwards;
        }
        
        .notification-exit {
            animation: notificationExit 0.5s forwards;
        }
        
        @keyframes notificationEnter {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes notificationExit {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Countdown styling */
        .countdown-timer {
            font-variant-numeric: tabular-nums;
        }
        
        /* Card categories */
        .category-learn .category-badge {
            background-color: rgba(34, 197, 94, 0.15);
            color: rgb(22, 163, 74);
        }
        
        .dark .category-learn .category-badge {
            background-color: rgba(34, 197, 94, 0.25);
            color: rgb(134, 239, 172);
        }
        
        .category-try .category-badge {
            background-color: rgba(249, 115, 22, 0.15);
            color: rgb(234, 88, 12);
        }
        
        .dark .category-try .category-badge {
            background-color: rgba(249, 115, 22, 0.25);
            color: rgb(253, 186, 116);
        }
        
        /* Category indicators */
        .category-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .category-indicator.learn {
            background-color: rgb(22, 163, 74);
        }
        
        .category-indicator.try {
            background-color: rgb(234, 88, 12);
        }
        
        /* Card styling */
        .card-header {
            border-radius: 8px 8px 0 0;
            transition: 0.3s ease;
        }
        
        .category-learn .card-header {
            background: linear-gradient(to right, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05));
        }
        
        .dark .category-learn .card-header {
            background: linear-gradient(to right, rgba(34, 197, 94, 0.25), rgba(34, 197, 94, 0.1));
        }
        
        .category-try .card-header {
            background: linear-gradient(to right, rgba(249, 115, 22, 0.15), rgba(249, 115, 22, 0.05));
        }
        
        .dark .category-try .card-header {
            background: linear-gradient(to right, rgba(249, 115, 22, 0.25), rgba(249, 115, 22, 0.1));
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-white transition-colors duration-300">
    <!-- Main Content Container -->
    <div id="app" class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Loading Overlay -->
        <div id="loading" class="fixed inset-0 flex items-center justify-center bg-white dark:bg-gray-900 z-50">
            <div class="text-center">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
                <p class="mt-4 text-lg">Loading resources...</p>
            </div>
        </div>

        <!-- Maintenance Mode Overlay -->
        <div id="maintenance-overlay" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 hidden">
            <div class="container mx-auto px-4 h-full flex flex-col items-center justify-center">
                <div class="mb-8 text-center animate-bounce-in">
                    <svg class="w-24 h-24 mx-auto text-yellow-500 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <h2 class="text-3xl font-bold mb-4">We'll be back soon!</h2>
                    <p id="maintenance-message" class="text-xl text-gray-600 dark:text-gray-300 mb-6">Our website is currently undergoing scheduled maintenance.</p>
                    
                    <!-- Countdown timer -->
                    <div id="countdown-container" class="mb-8 hidden">
                        <p class="text-lg mb-4">Estimated time remaining:</p>
                        <div class="flex justify-center space-x-4 countdown-timer">
                            <div class="text-center">
                                <div id="countdown-days" class="text-4xl font-bold">0</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Days</div>
                            </div>
                            <div class="text-center">
                                <div id="countdown-hours" class="text-4xl font-bold">0</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Hours</div>
                            </div>
                            <div class="text-center">
                                <div id="countdown-minutes" class="text-4xl font-bold">0</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Minutes</div>
                            </div>
                            <div class="text-center">
                                <div id="countdown-seconds" class="text-4xl font-bold">0</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Seconds</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Container -->
        <div id="notification-container" class="fixed right-4 top-20 z-40 w-80 space-y-4"></div>

        <!-- Maintenance Mode Banner -->
        <div id="maintenance-banner" class="hidden bg-yellow-100 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-100 px-4 py-3 rounded-lg mb-6 animate-fade-in">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <span id="maintenance-message-banner">This site is currently undergoing maintenance. Some features may be unavailable.</span>
            </div>
        </div>

        <!-- Customer Message Banner -->
        <div id="customer-message-banner" class="hidden bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-100 px-4 py-3 rounded-lg mb-6 animate-fade-in">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span id="customer-message-text">Important information for our users.</span>
                </div>
                <button id="close-customer-message" class="hover:bg-blue-200 dark:hover:bg-blue-700 p-1 rounded">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Header -->
        <header class="mb-8 text-center">
            <div class="dark-mode-toggle absolute top-4 right-4 cursor-pointer p-2 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-full transition-colors" title="Toggle Dark Mode">
                <!-- Sun icon for dark mode -->
                <svg id="light-icon" class="hidden w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
                <!-- Moon icon for light mode -->
                <svg id="dark-icon" class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
            </div>
            <h1 id="site-title" class="text-4xl font-bold mb-2 animate-fade-in">Study Resources</h1>
            <p id="site-description" class="text-xl text-gray-600 dark:text-gray-300 mb-6 animate-fade-in">Your collection of English language study materials</p>
            <div id="greeting" class="py-4 px-6 bg-primary/10 dark:bg-primary/20 rounded-lg text-primary dark:text-primary-light inline-block animate-slide-up"></div>
        </header>

        <!-- Main Category Tabs -->
        <div class="mb-8">
            <div class="flex flex-wrap border-b border-gray-200 dark:border-gray-700">
                <button id="all-tab" class="category-tab active px-6 py-3 text-lg font-medium focus:outline-none text-primary" data-category="all">
                    All Resources
                </button>
                <button id="learn-tab" class="category-tab px-6 py-3 text-lg font-medium focus:outline-none text-learn-light dark:text-learn-light" data-category="learn">
                    <span class="category-indicator learn"></span>Learn
                </button>
                <button id="try-tab" class="category-tab px-6 py-3 text-lg font-medium focus:outline-none text-try-light dark:text-try-light" data-category="try">
                    <span class="category-indicator try"></span>Try 
                </button>
            </div>
        </div>

        <!-- Subcategory Filters -->
        <div id="subcategory-filters" class="mb-8">
            <div id="learn-subcategories" class="hidden animate-fade-in">
                <div class="flex flex-wrap gap-2 mb-4">
                    <button class="subcategory-btn px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-green-100 dark:hover:bg-green-900 focus:outline-none active" data-parent="learn" data-subcategory="all">All</button>
                    <button class="subcategory-btn px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-green-100 dark:hover:bg-green-900 focus:outline-none" data-parent="learn" data-subcategory="video">Video</button>
                    <button class="subcategory-btn px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-green-100 dark:hover:bg-green-900 focus:outline-none" data-parent="learn" data-subcategory="notes">Notes</button>
                </div>
            </div>

            <div id="try-subcategories" class="hidden animate-fade-in">
                <div class="flex flex-wrap gap-2 mb-4">
                    <button class="subcategory-btn px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-orange-100 dark:hover:bg-orange-900 focus:outline-none active" data-parent="try" data-subcategory="all">All</button>
                    <button class="subcategory-btn px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-orange-100 dark:hover:bg-orange-900 focus:outline-none" data-parent="try" data-subcategory="speaking">Speaking</button>
                    <button class="subcategory-btn px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-orange-100 dark:hover:bg-orange-900 focus:outline-none" data-parent="try" data-subcategory="listening">Listening</button>
                    <button class="subcategory-btn px-4 py-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-orange-100 dark:hover:bg-orange-900 focus:outline-none" data-parent="try" data-subcategory="grammar-reading">Grammar & Reading</button>
                </div>
            </div>
        </div>

        <!-- Resources Section -->
        <section class="mb-12">
            <!-- Search and Filters -->
            <div class="mb-8 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 animate-fade-in">
                <div class="flex flex-col lg:flex-row gap-4">
                    <div class="flex-1">
                        <label for="search-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Search</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <input type="text" id="search-input" placeholder="Search resources..." class="pl-10 block w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                        </div>
                    </div>
                    <div>
                        <label for="sort-by" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Sort By</label>
                        <select id="sort-by" class="block w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary text-base">
                            <option value="title-asc">Title (A-Z)</option>
                            <option value="title-desc">Title (Z-A)</option>
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 invisible">Reset</label>
                        <button id="reset-filters" class="w-full px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition text-base">
                            Reset Filters
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Resources Grid -->
            <div id="resources-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Resource cards will be dynamically inserted here -->
            </div>
            
            <!-- No Results Message -->
            <div id="no-results" class="hidden text-center py-12 animate-fade-in">
                <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-xl text-gray-600 dark:text-gray-400">No resources match your search criteria</p>
                <button id="clear-search" class="mt-4 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition">Clear Search</button>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-gray-600 dark:text-gray-400 py-6 border-t border-gray-200 dark:border-gray-800">
            <div class="flex justify-center space-x-4 mb-4">
                <button id="privacy-btn" class="text-primary hover:underline">Privacy Policy</button>
                <span>|</span>
                <button id="terms-btn" class="text-primary hover:underline">Terms of Service</button>
            </div>
            <p id="footer-copyright" class="text-sm">&copy; 2023 Study Resources. All rights reserved.</p>
        </footer>
    </div>

    <!-- Dialog Overlay -->
    <div id="dialog-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-xl animate-bounce-in">
            <div class="p-6">
                <div class="flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-3 mb-4">
                    <h3 id="dialog-title" class="text-xl font-semibold"></h3>
                    <button id="dialog-close" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div id="dialog-content" class="prose dark:prose-invert max-w-none">
                    <!-- Dialog content will be inserted here -->
                </div>
                <div class="mt-6 flex justify-end">
                    <button id="dialog-accept" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/90 transition">I Accept</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Resource Access Dialog -->
    <div id="resource-access-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full shadow-xl animate-bounce-in">
            <div class="p-6">
                <div class="flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-3 mb-4">
                    <h3 class="text-xl font-semibold">Access Resource</h3>
                    <button id="resource-dialog-close" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <p>By accessing this resource, you agree to our Terms of Service and Privacy Policy. Please read these documents before proceeding.</p>
                <div class="mt-6 flex justify-between">
                    <button id="view-terms-privacy" class="text-primary hover:underline">View Terms & Privacy</button>
                    <button id="resource-access-btn" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/90 transition">I Agree & Access</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let siteSettings = {};
        let resources = [];
        let termsAccepted = localStorage.getItem('termsAccepted') === 'true';
        let selectedResource = null;
        let activeMainCategory = 'all';
        let activeSubcategories = {
            learn: 'all',
            try: 'all'
        };
        let countdownInterval = null;
        let maintenanceEndTime = null;
        let notificationQueue = [];

        // DOM Elements
        const loadingElement = document.getElementById('loading');
        const maintenanceOverlay = document.getElementById('maintenance-overlay');
        const maintenanceMessage = document.getElementById('maintenance-message');
        const maintenanceBanner = document.getElementById('maintenance-banner');
        const maintenanceMessageBanner = document.getElementById('maintenance-message-banner');
        const customerMessageBanner = document.getElementById('customer-message-banner');
        const customerMessageText = document.getElementById('customer-message-text');
        const closeCustomerMessageButton = document.getElementById('close-customer-message');
        const siteTitleElement = document.getElementById('site-title');
        const siteDescriptionElement = document.getElementById('site-description');
        const greetingElement = document.getElementById('greeting');
        const resourcesGrid = document.getElementById('resources-grid');
        const footerCopyrightElement = document.getElementById('footer-copyright');
        const noResultsElement = document.getElementById('no-results');
        const clearSearchButton = document.getElementById('clear-search');
        const searchInput = document.getElementById('search-input');
        const sortBySelect = document.getElementById('sort-by');
        const resetFiltersButton = document.getElementById('reset-filters');
        const categoryTabs = document.querySelectorAll('.category-tab');
        const subcategoryFilters = document.getElementById('subcategory-filters');
        const learnSubcategories = document.getElementById('learn-subcategories');
        const trySubcategories = document.getElementById('try-subcategories');
        const notificationContainer = document.getElementById('notification-container');
        
        // Countdown Elements
        const countdownContainer = document.getElementById('countdown-container');
        const countdownDays = document.getElementById('countdown-days');
        const countdownHours = document.getElementById('countdown-hours');
        const countdownMinutes = document.getElementById('countdown-minutes');
        const countdownSeconds = document.getElementById('countdown-seconds');
        
        // Dialog Elements
        const dialogOverlay = document.getElementById('dialog-overlay');
        const dialogTitle = document.getElementById('dialog-title');
        const dialogContent = document.getElementById('dialog-content');
        const dialogCloseButton = document.getElementById('dialog-close');
        const dialogAcceptButton = document.getElementById('dialog-accept');
        
        // Resource Access Dialog Elements
        const resourceAccessOverlay = document.getElementById('resource-access-overlay');
        const resourceDialogCloseButton = document.getElementById('resource-dialog-close');
        const resourceAccessButton = document.getElementById('resource-access-btn');
        const viewTermsPrivacyButton = document.getElementById('view-terms-privacy');
        
        // Button Elements
        const privacyButton = document.getElementById('privacy-btn');
        const termsButton = document.getElementById('terms-btn');
        
        // Dark Mode Elements
        const darkModeToggle = document.querySelector('.dark-mode-toggle');
        const darkIcon = document.getElementById('dark-icon');
        const lightIcon = document.getElementById('light-icon');

        // Initialize dark mode based on user preference
        function initDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                updateDarkModeIcons(true);
            }

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    updateDarkModeIcons(true);
                } else {
                    document.documentElement.classList.remove('dark');
                    updateDarkModeIcons(false);
                }
            });
        }

        function updateDarkModeIcons(isDark) {
            if (isDark) {
                darkIcon.classList.add('hidden');
                lightIcon.classList.remove('hidden');
            } else {
                darkIcon.classList.remove('hidden');
                lightIcon.classList.add('hidden');
            }
        }

        // Toggle dark mode
        darkModeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            updateDarkModeIcons(isDark);
        });

        // Fetch settings from JSON file
        async function fetchSettings() {
            try {
                const response = await fetch('/settings.json');
                if (!response.ok) {
                    throw new Error('Failed to fetch settings');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching settings:', error);
                return null;
            }
        }

        // Initialize the application
        async function initApp() {
            initDarkMode();
            
            // Fetch settings
            const settings = await fetchSettings();
            if (!settings) {
                showError('Failed to load settings. Please try again later.');
                return;
            }
            
            siteSettings = settings;
            resources = settings.resources || [];
            
            // Update site metadata
            updateSiteMetadata();
            
            // Check maintenance mode
            checkMaintenanceMode();
            
            // Check for customer message
            checkCustomerMessage();
            
            // Initialize notifications
            initializeNotifications();
            
            // Initialize resources
            initializeResources();
            
            // Initialize category tabs
            initializeCategoryTabs();
            
            // Initialize search and filters
            initializeFilters();
            
            // Initialize greetings
            showRandomGreeting();
            
            // Initialize dialogs
            initDialogs();
            
            // Hide loading screen with a slight delay for smoother transition
            setTimeout(() => {
                loadingElement.style.opacity = '0';
                loadingElement.style.transition = 'opacity 0.3s ease';
                setTimeout(() => {
                    loadingElement.classList.add('hidden');
                }, 300);
            }, 500);
            
            // Check if terms need to be shown
            if (!termsAccepted && siteSettings.showTermsOnLoad) {
                showTermsAndPrivacy();
            }
        }

        // Update site metadata from settings
        function updateSiteMetadata() {
            document.title = siteSettings.siteTitle || 'Study Resources';
            siteTitleElement.textContent = siteSettings.siteTitle || 'Study Resources';
            siteDescriptionElement.textContent = siteSettings.siteDescription || 'Your collection of English language study materials';
            footerCopyrightElement.textContent = siteSettings.footerText || '© 2023 Study Resources. All rights reserved.';
        }

        // Check if site is in maintenance mode
        function checkMaintenanceMode() {
            const { maintenanceMode, maintenanceEndTime, maintenanceMessage: message } = siteSettings;
            
            if (maintenanceMode) {
                if (maintenanceMode === 'full') {
                    // Full maintenance mode - show overlay
                    maintenanceMessage.textContent = message || 'Our website is currently undergoing scheduled maintenance.';
                    
                    // Check if countdown is enabled
                    if (maintenanceEndTime) {
                        initializeCountdown(maintenanceEndTime);
                    }
                    
                    maintenanceOverlay.classList.remove('hidden');
                } else if (maintenanceMode === 'partial') {
                    // Partial maintenance - show banner
                    maintenanceMessageBanner.textContent = message || 'This site is currently undergoing maintenance. Some features may be unavailable.';
                    maintenanceBanner.classList.remove('hidden');
                }
            }
        }

        // Initialize countdown timer
        function initializeCountdown(endTimeStr) {
            try {
                maintenanceEndTime = new Date(endTimeStr).getTime();
                
                // Invalid date check
                if (isNaN(maintenanceEndTime)) {
                    console.error('Invalid maintenance end time format');
                    return;
                }
                
                // Show countdown container
                countdownContainer.classList.remove('hidden');
                
                // Start countdown
                updateCountdown();
                countdownInterval = setInterval(updateCountdown, 1000);
            } catch (error) {
                console.error('Error initializing countdown:', error);
            }
        }

        // Update countdown timer
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = maintenanceEndTime - now;
            
            // When countdown is finished
            if (distance < 0) {
                clearInterval(countdownInterval);
                countdownDays.textContent = '0';
                countdownHours.textContent = '0';
                countdownMinutes.textContent = '0';
                countdownSeconds.textContent = '0';
                
                // Add "Completed" message
                const completedEl = document.createElement('div');
                completedEl.className = 'text-center mt-4 text-green-500 dark:text-green-400 font-bold text-lg';
                completedEl.textContent = 'Maintenance should be completed. Please refresh the page.';
                countdownContainer.appendChild(completedEl);
                
                return;
            }
            
            // Time calculations
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            // Update elements
            countdownDays.textContent = days;
            countdownHours.textContent = hours.toString().padStart(2, '0');
            countdownMinutes.textContent = minutes.toString().padStart(2, '0');
            countdownSeconds.textContent = seconds.toString().padStart(2, '0');
        }

        // Check if customer message should be displayed
        function checkCustomerMessage() {
            if (siteSettings.showCustomerMessage && siteSettings.customerMessage) {
                customerMessageText.textContent = siteSettings.customerMessage;
                customerMessageBanner.classList.remove('hidden');
                
                // Add event listener to close button
                closeCustomerMessageButton.addEventListener('click', () => {
                    customerMessageBanner.classList.add('hidden');
                });
            }
        }

        // Initialize notifications
        function initializeNotifications() {
            if (siteSettings.notifications && Array.isArray(siteSettings.notifications)) {
                notificationQueue = [...siteSettings.notifications];
                
                // Show first notification after a delay
                if (notificationQueue.length > 0) {
                    setTimeout(() => {
                        showNextNotification();
                    }, 2000);
                }
            }
        }

        // Show next notification from queue
        function showNextNotification() {
            if (notificationQueue.length === 0) return;
            
            const notification = notificationQueue.shift();
            const delay = notification.duration || 5000;
            
            // Create notification element
            const notificationEl = document.createElement('div');
            notificationEl.className = 'notification bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden notification-enter';
            
            // Determine notification color based on type
            let typeClass = '';
            let iconSvg = '';
            
            switch (notification.type) {
                case 'info':
                    typeClass = 'border-l-4 border-blue-500';
                    iconSvg = '<svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    break;
                case 'success':
                    typeClass = 'border-l-4 border-green-500';
                    iconSvg = '<svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    break;
                case 'warning':
                    typeClass = 'border-l-4 border-yellow-500';
                    iconSvg = '<svg class="w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';
                    break;
                case 'error':
                    typeClass = 'border-l-4 border-red-500';
                    iconSvg = '<svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    break;
                default:
                    typeClass = 'border-l-4 border-gray-500';
                    iconSvg = '<svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            }
            
            notificationEl.classList.add(typeClass);
            
            // Create notification content
            notificationEl.innerHTML = `
                <div class="p-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            ${iconSvg}
                        </div>
                        <div class="ml-3 w-0 flex-1">
                            ${notification.title ? `<p class="text-sm font-medium text-gray-900 dark:text-white">${notification.title}</p>` : ''}
                            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">${notification.message}</p>
                        </div>
                        <div class="ml-4 flex-shrink-0 flex">
                            <button class="notification-close inline-flex text-gray-400 dark:text-gray-600 hover:text-gray-500 dark:hover:text-gray-400 focus:outline-none">
                                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add to container
            notificationContainer.appendChild(notificationEl);
            
            // Add close button handler
            notificationEl.querySelector('.notification-close').addEventListener('click', () => {
                removeNotification(notificationEl);
            });
            
            // Auto remove after delay
            setTimeout(() => {
                removeNotification(notificationEl);
            }, delay);
        }

        // Remove notification with animation
        function removeNotification(notificationEl) {
            notificationEl.classList.remove('notification-enter');
            notificationEl.classList.add('notification-exit');
            
            // Remove from DOM after animation completes
            setTimeout(() => {
                if (notificationEl.parentNode) {
                    notificationEl.parentNode.removeChild(notificationEl);
                }
                
                // Show next notification with a delay
                if (notificationQueue.length > 0) {
                    setTimeout(() => {
                        showNextNotification();
                    }, 500);
                }
            }, 500);
        }

        // Initialize resources grid
        function initializeResources() {
            resourcesGrid.innerHTML = '';
            
            if (!resources.length) {
                noResultsElement.classList.remove('hidden');
                return;
            }
            
            // Create resource cards
            resources.forEach((resource, index) => {
                const card = createResourceCard(resource, index);
                resourcesGrid.appendChild(card);
            });
            
            // Initial filtering
            filterResources();
        }

        // Initialize category tabs
        function initializeCategoryTabs() {
            // Set up click handlers for main category tabs
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Update active class
                    categoryTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Get category
                    activeMainCategory = tab.dataset.category;
                    
                    // Show corresponding subcategories
                    updateSubcategoryDisplay();
                    
                    // Update resource display
                    filterResources();
                });
            });
            
            // Set up click handlers for subcategory buttons
            document.querySelectorAll('.subcategory-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Get parent category and subcategory
                    const parent = btn.dataset.parent;
                    const subcategory = btn.dataset.subcategory;
                    
                    // Update active class within this parent's subcategories
                    document.querySelectorAll(`.subcategory-btn[data-parent="${parent}"]`).forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    
                    // Update active subcategory
                    activeSubcategories[parent] = subcategory;
                    
                    // Update resource display
                    filterResources();
                });
            });
        }

        // Update subcategory filters display based on active main category
        function updateSubcategoryDisplay() {
            // Hide all subcategory containers
            learnSubcategories.classList.add('hidden');
            trySubcategories.classList.add('hidden');
            
            // Show the appropriate one
            if (activeMainCategory === 'learn') {
                learnSubcategories.classList.remove('hidden');
            } else if (activeMainCategory === 'try') {
                trySubcategories.classList.remove('hidden');
            }
        }

        // Create a resource card element
        function createResourceCard(resource, index) {
            const card = document.createElement('div');
            
            // Determine card category styling
            let categoryClass = '';
            if (resource.category === 'learn') {
                categoryClass = 'category-learn';
            } else if (resource.category === 'try') {
                categoryClass = 'category-try';
            }
            
            card.className = `resource-card bg-white dark:bg-gray-800 rounded-lg shadow-card hover:shadow-card-hover overflow-hidden border border-gray-200 dark:border-gray-700 animate-fade-in ${categoryClass}`;
            card.style.animationDelay = `${index * 0.05}s`;
            
            // Format date if available
            let dateDisplay = '';
            if (resource.date) {
                const date = new Date(resource.date);
                if (!isNaN(date)) {
                    dateDisplay = `<div class="text-xs text-gray-500 dark:text-gray-400">${date.toLocaleDateString()}</div>`;
                }
            }
            
            // Create subcategory badge
            let subcategoryBadge = '';
            if (resource.subcategory) {
                subcategoryBadge = `<span class="category-badge px-2 py-1 text-xs font-medium rounded">${resource.subcategory}</span>`;
            }
            
            const cardContent = `
                <div class="card-header p-3 flex items-center justify-between">
                    ${subcategoryBadge}
                    ${dateDisplay}
                </div>
                <div class="p-5">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">${resource.title}</h3>
                    <p class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-2 h-12">${resource.description || 'No description provided'}</p>
                    <button class="resource-access-btn w-full px-4 py-2 bg-primary hover:bg-primary-dark dark:bg-primary-light dark:hover:bg-primary text-white rounded transition-colors" data-index="${index}">
                        Access Resource
                    </button>
                </div>
            `;
            
            card.innerHTML = cardContent;
            return card;
        }

        // Initialize search and filter functionality
        function initializeFilters() {
            // Search functionality
            searchInput.addEventListener('input', filterResources);
            
            // Sort functionality
            sortBySelect.addEventListener('change', sortResources);
            
            // Reset filters
            resetFiltersButton.addEventListener('click', () => {
                searchInput.value = '';
                sortBySelect.value = 'title-asc';
                
                // Reset categories
                document.querySelector('#all-tab').click();
                
                // Reset all subcategories to 'all'
                document.querySelectorAll('.subcategory-btn[data-subcategory="all"]').forEach(btn => {
                    btn.click();
                });
                
                filterResources();
            });
            
            // Clear search button
            clearSearchButton.addEventListener('click', () => {
                searchInput.value = '';
                filterResources();
            });
        }

        // Filter resources based on search, categories, and subcategories
        function filterResources() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            let filteredCount = 0;
            
            Array.from(resourcesGrid.children).forEach(card => {
                const index = card.querySelector('.resource-access-btn').dataset.index;
                const resource = resources[index];
                
                // Check search term
                const matchesSearch = !searchTerm ||
                    resource.title.toLowerCase().includes(searchTerm) ||
                    (resource.description && resource.description.toLowerCase().includes(searchTerm));
                
                // Check main category
                const matchesMainCategory = 
                    activeMainCategory === 'all' || 
                    resource.category === activeMainCategory;
                
                // Check subcategory
                let matchesSubcategory = true;
                if (matchesMainCategory && resource.category !== 'all') {
                    const activeSubcat = activeSubcategories[resource.category];
                    matchesSubcategory = 
                        activeSubcat === 'all' || 
                        resource.subcategory === activeSubcat;
                }
                
                // Show/hide card
                if (matchesSearch && matchesMainCategory && matchesSubcategory) {
                    card.classList.remove('hidden');
                    filteredCount++;
                } else {
                    card.classList.add('hidden');
                }
            });
            
            // Show/hide no results message
            if (filteredCount === 0) {
                noResultsElement.classList.remove('hidden');
            } else {
                noResultsElement.classList.add('hidden');
            }
        }

        // Sort resources
        function sortResources() {
            const sortValue = sortBySelect.value;
            const resourceCards = Array.from(resourcesGrid.children);
            
            resourceCards.sort((a, b) => {
                const indexA = a.querySelector('.resource-access-btn').dataset.index;
                const indexB = b.querySelector('.resource-access-btn').dataset.index;
                const resourceA = resources[indexA];
                const resourceB = resources[indexB];
                
                switch (sortValue) {
                    case 'title-asc':
                        return resourceA.title.localeCompare(resourceB.title);
                    case 'title-desc':
                        return resourceB.title.localeCompare(resourceA.title);
                    case 'newest':
                        return new Date(resourceB.date || 0) - new Date(resourceA.date || 0);
                    case 'oldest':
                        return new Date(resourceA.date || 0) - new Date(resourceB.date || 0);
                    default:
                        return 0;
                }
            });
            
            // Re-append cards in sorted order
            resourceCards.forEach(card => resourcesGrid.appendChild(card));
        }

        // Show random greeting from settings
        function showRandomGreeting() {
            if (siteSettings.greetings && siteSettings.greetings.length > 0) {
                const randomIndex = Math.floor(Math.random() * siteSettings.greetings.length);
                greetingElement.textContent = siteSettings.greetings[randomIndex];
            } else {
                greetingElement.textContent = "Welcome to our Study Resources!";
            }
        }

        // Initialize dialog event listeners
        function initDialogs() {
            // Close dialog buttons
            dialogCloseButton.addEventListener('click', closeDialog);
            resourceDialogCloseButton.addEventListener('click', closeResourceDialog);
            
            // Accept terms button
            dialogAcceptButton.addEventListener('click', () => {
                termsAccepted = true;
                localStorage.setItem('termsAccepted', 'true');
                closeDialog();
                
                // If dialog was shown from resource access, open resource
                if (selectedResource) {
                    openResource(selectedResource);
                }
            });
            
            // Resource access button
            resourceAccessButton.addEventListener('click', () => {
                closeResourceDialog();
                showTermsAndPrivacy(); // Show Terms and Privacy before accessing the resource
            });
            
            // View terms and privacy from resource dialog
            viewTermsPrivacyButton.addEventListener('click', () => {
                closeResourceDialog();
                showTermsAndPrivacy();
            });
            
            // Privacy and terms buttons
            privacyButton.addEventListener('click', () => showPrivacyPolicy());
            termsButton.addEventListener('click', () => showTermsOfService());
            
            // Global event delegation for resource buttons
            resourcesGrid.addEventListener('click', (e) => {
                const accessBtn = e.target.closest('.resource-access-btn');
                if (accessBtn) {
                    const index = parseInt(accessBtn.dataset.index);
                    selectedResource = resources[index];
                    
                    if (termsAccepted) {
                        openResource(selectedResource);
                    } else {
                        showResourceAccessDialog();
                    }
                }
            });
        }

        // Show terms and privacy policy dialog
        function showTermsAndPrivacy() {
            dialogTitle.textContent = 'Terms of Service & Privacy Policy';
            
            let content = '<div class="mb-6">';
            content += '<h4 class="text-lg font-semibold mb-2">Terms of Service</h4>';
            content += `<div>${siteSettings.termsOfService || 'Terms of Service content not available.'}</div>`;
            content += '</div>';
            
            content += '<div>';
            content += '<h4 class="text-lg font-semibold mb-2">Privacy Policy</h4>';
            content += `<div>${siteSettings.privacyPolicy || 'Privacy Policy content not available.'}</div>`;
            content += '</div>';
            
            dialogContent.innerHTML = content;
            dialogAcceptButton.textContent = 'I Accept';
            dialogOverlay.classList.remove('hidden');
        }

        // Show privacy policy dialog
        function showPrivacyPolicy() {
            dialogTitle.textContent = 'Privacy Policy';
            dialogContent.innerHTML = siteSettings.privacyPolicy || 'Privacy Policy content not available.';
            dialogAcceptButton.textContent = 'Close';
            dialogOverlay.classList.remove('hidden');
        }

        // Show terms of service dialog
        function showTermsOfService() {
            dialogTitle.textContent = 'Terms of Service';
            dialogContent.innerHTML = siteSettings.termsOfService || 'Terms of Service content not available.';
            dialogAcceptButton.textContent = 'Close';
            dialogOverlay.classList.remove('hidden');
        }

        // Show resource access dialog
        function showResourceAccessDialog() {
            resourceAccessOverlay.classList.remove('hidden');
        }

        // Close main dialog
        function closeDialog() {
            dialogOverlay.classList.add('hidden');
        }

        // Close resource access dialog
        function closeResourceDialog() {
            resourceAccessOverlay.classList.add('hidden');
        }

        // Open resource URL
        function openResource(resource) {
            if (resource && resource.url) {
                window.open(resource.url, '_blank');
            } else {
                showError('Resource URL is not available.');
            }
        }

        // Show error message
        function showError(message) {
            dialogTitle.textContent = 'Error';
            dialogContent.innerHTML = `<p class="text-red-500">${message}</p>`;
            dialogAcceptButton.textContent = 'OK';
            dialogOverlay.classList.remove('hidden');
        }

        // Initialize the app on load
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
